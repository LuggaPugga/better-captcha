---
title: Qwik
description: 在 Qwik 中使用 better-captcha
icon: qwik
---

## 安装

```npm
npm i @better-captcha/qwik
```

## 基本用法

```tsx
import { component$ } from "@builder.io/qwik";
import { ReCaptcha } from "@better-captcha/qwik/provider/recaptcha";

export default component$(() => {
  return <ReCaptcha sitekey="your-site-key" />;
});
```

## 命令式句柄

Qwik 使用 `useCaptchaController` hook 通过控制器模式访问命令式句柄,该模式适用于 Qwik 的序列化模型。

```tsx
import { component$ } from "@builder.io/qwik";
import { useCaptchaController } from "@better-captcha/qwik";
import { ReCaptcha, type ReCaptchaHandle } from "@better-captcha/qwik/provider/recaptcha";

export default component$(() => {
  const controller = useCaptchaController<ReCaptchaHandle>();

  return (
    <>
      <ReCaptcha 
        sitekey="6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI" 
        controller={controller}
      />
      <button onClick$={() => controller.value?.execute()}>Execute</button>
      <button onClick$={() => controller.value?.reset()}>Reset</button>
      <button onClick$={() => console.log(controller.value?.getResponse())}>Log response</button>
    </>
  );
});
```

<Callout type="info">
句柄在小部件准备就绪后可用。调用方法时始终使用可选链(`?.`),因为控制器可能尚未初始化。
</Callout>

## 生命周期回调

所有验证码组件都通过 QRL 属性支持三个生命周期回调。注意 Qwik 对可序列化函数要求的 `$` 后缀。

```tsx
import { component$, $ } from "@builder.io/qwik";
import { useCaptchaController } from "@better-captcha/qwik";
import { ReCaptcha, type ReCaptchaHandle } from "@better-captcha/qwik/provider/recaptcha";

export default component$(() => {
  const controller = useCaptchaController<ReCaptchaHandle>();

  const handleReady$ = $((handle: ReCaptchaHandle) => {
    console.log("Captcha is ready", handle);
  });

  const handleSolve$ = $((token: string) => {
    console.log("Captcha solved with token:", token);
    // Send token to your backend for verification
  });

  const handleError$ = $((error: Error) => {
    console.error("Captcha error:", error);
  });

  return (
    <ReCaptcha
      sitekey="6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI"
      controller={controller}
      onReady$={handleReady$}
      onSolve$={handleSolve$}
      onError$={handleError$}
    />
  );
});
```

| Callback | Parameters | Description |
|----------|-----------|-------------|
| `onReady$` | `(handle: Handle) => void` | 当小部件渲染完成并准备就绪时调用(接收句柄) |
| `onSolve$` | `(token: string) => void` | 当挑战完成并返回响应令牌时调用 |
| `onError$` | `(error: Error) => void` | 当初始化或求解过程中发生错误时调用 |

## 手动渲染

默认情况下,验证码会在挂载时自动渲染。如需更多控制,可以禁用自动渲染并手动触发。

```tsx
import { component$ } from "@builder.io/qwik";
import { useCaptchaController } from "@better-captcha/qwik";
import { ReCaptcha } from "@better-captcha/qwik/provider/recaptcha";

export default component$(() => {
  const controller = useCaptchaController();

  return (
    <>
      <ReCaptcha 
        sitekey="6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI" 
        controller={controller} 
        autoRender={false} 
      />
      <button onClick$={async () => await controller.value?.render()}>Show Captcha</button>
    </>
  );
});
```

## 通用属性

| Prop | Type | Required | Description |
|------|------|----------|-------------|
| `sitekey` | `string` | ✅ | 您的提供商网站密钥 |
| `controller` | `Signal` | ❌ | 来自 `useCaptchaController()` 的控制器,用于命令式访问 |
| `options` | `object` | ❌ | 特定于提供商的配置选项 |
| `autoRender` | `boolean` | ❌ | 是否在挂载时自动渲染(默认: `true`) |
| `scriptOptions` | `object` | ❌ | 脚本加载配置(参见[脚本选项](/cn/docs/script-options)) |
| `onReady$` | `QRL` | ❌ | 小部件就绪时的回调 |
| `onSolve$` | `QRL` | ❌ | 挑战完成时的回调 |
| `onError$` | `QRL` | ❌ | 发生错误时的回调 |

## 句柄方法

所有提供商都在句柄上实现了这些方法:

<AutoTypeTable path="../../packages/core/src/provider.ts" name="CaptchaHandle" />

## 可用的提供商

| Provider | Import Path |
|----------|-------------|
| **ReCaptcha** | `@better-captcha/qwik/provider/recaptcha` |
| **HCaptcha** | `@better-captcha/qwik/provider/hcaptcha` |
| **Turnstile** | `@better-captcha/qwik/provider/turnstile` |
| **Friendly Captcha** | `@better-captcha/qwik/provider/friendly-captcha` |
| **Private Captcha** | `@better-captcha/qwik/provider/private-captcha` |
| **Captcha Fox** | `@better-captcha/qwik/provider/captcha-fox` |
| **Prosopo** | `@better-captcha/qwik/provider/prosopo` |
| **CapWidget** | `@better-captcha/qwik/provider/cap-widget` |

请参阅[提供商文档](/cn/docs/provider)了解特定于提供商的选项和配置。
